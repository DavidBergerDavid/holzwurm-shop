<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Holzwurm ‚Äì Dummy Shop</title>
<style>
  :root{
    --brand:#0b3d2e; --brand-weak:#e6f2ee; --bg:#fffaf2; --fg:#1f2937; --muted:#6b7280; --border:#e5e7eb;
  }
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(#fff5e6,#f8fafc);font-family:system-ui,Segoe UI,Inter,Arial,sans-serif;color:var(--fg)}
  header{position:sticky;top:0;background:#fff8;backdrop-filter:blur(6px);border-bottom:1px solid var(--border);z-index:10}
  .container{max-width:1100px;margin:0 auto;padding:12px 16px}
  h1{margin:6px 0 2px}
  .row{display:flex;gap:8px;align-items:center}
  input,textarea,select{padding:10px;border:1px solid #d1d5db;border-radius:12px;font-size:14px}
  button{border:1px solid var(--brand);background:var(--brand);color:#fff;border-radius:14px;font-weight:600;padding:10px 14px;cursor:pointer}
  button.ghost{background:transparent;color:var(--fg);border-color:transparent}
  button.outline{background:#fff;border-color:var(--brand);color:var(--brand)}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px}
  .card{background:#fff;border:1px solid var(--border);border-radius:18px;overflow:hidden;box-shadow:0 2px 6px rgba(0,0,0,.04)}
  .card img.main{width:100%;height:160px;object-fit:cover}
  .thumb{width:56px;height:42px;object-fit:cover;border-radius:8px;cursor:pointer;border:1px solid var(--border)}
  .pad{padding:14px} .muted{color:var(--muted)} .small{font-size:12px}
  .badge{border:1px solid var(--brand-weak);background:var(--brand-weak);padding:2px 8px;border-radius:999px;font-size:10px;letter-spacing:.06em;margin-left:6px}
  .cart{position:fixed;right:16px;top:70px;width:380px;max-width:calc(100% - 32px);background:#fff;border:1px solid var(--border);border-radius:18px;padding:14px;box-shadow:0 10px 30px rgba(0,0,0,.12);display:none;max-height:85vh;overflow:auto}
  .cart.open{display:block}
  footer{border-top:1px solid var(--border);margin-top:36px;padding:16px 0;font-size:12px;color:var(--muted)}
  @media (max-width:720px){ .cart{width:100%;right:0;top:64px;border-radius:0;border-left:none;border-right:none} }
</style>
</head>
<body>
<header>
  <div class="container row">
    <strong>üå≤ Holzwurm</strong><span class="badge">Demo</span>
    <input id="search" placeholder="Suche: Artikel, SKU, Tags‚Ä¶" style="margin-left:auto;width:280px"/>
    <button id="cartBtn">üõí Warenkorb <span id="cartCount">(0)</span></button>
  </div>
</header>

<main class="container">
  <section>
    <h1>Online-Shop (Dummy)</h1>
    <p class="muted">Standardprodukte k√∂nnen <b>direkt bestellt</b> werden. F√ºr <b>Individualzuschnitte</b> senden Sie eine
      <b>unverbindliche Anfrage</b>. Der Versand erfolgt hier in der Demo als JSON-Payload.</p>
  </section>

  <!-- PRODUKT-LISTE -->
  <section id="products" class="grid"></section>

  <!-- INDIVIDUALZUSCHNITTE EINGABE -->
  <section class="card" style="margin-top:16px">
    <div class="pad">
      <h3 style="margin:0 0 8px">Individualzuschnitte ‚Äì Anfrage</h3>
      <p class="muted small" style="margin:0 0 8px">
        Beschreiben Sie kurz, was gebaut werden soll (Material, Ma√üe, Kante, Lochbild, Oberfl√§che).
        <br>Hinweis: Ein vollwertiger <b>Konfigurator</b> ist in Planung ‚Äì zun√§chst freie Beschreibung.
      </p>
      <div class="row" style="gap:8px;margin-bottom:8px">
        <input id="custom_qty" type="number" min="1" value="1" style="width:120px" />
        <input id="custom_title" placeholder="Bezeichnung (z. B. TV-Board nach Ma√ü)" style="flex:1"/>
      </div>
      <textarea id="custom_note" rows="4" placeholder="Details: Material, Ma√üe (L√óB√óSt√§rke), Kanten, St√ºckliste, Hinweise‚Ä¶" style="width:100%"></textarea>

      <!-- Lieferzeit & Staffelpreise -->
      <div class="row" style="gap:8px;margin-top:8px">
        <select id="custom_speed" style="flex:1">
          <option value="8">Lieferzeit 8 Tage ‚Äì ‚Ç¨ 1.467,90</option>
          <option value="15" selected>Lieferzeit 15 Tage ‚Äì ‚Ç¨ 1.425,96</option>
          <option value="20">Lieferzeit 20 Tage ‚Äì ‚Ç¨ 1.370,04</option>
        </select>
        <span class="small muted">Preis abh√§ngig von Lieferzeit</span>
      </div>

      <div class="row" style="gap:8px;margin-top:8px">
        <button class="outline" onclick="addCustom()">‚ûï Individualzuschnitt in Warenkorb</button>
        <a href="#" class="small muted" onclick="alert('Konfigurator-Demo folgt ‚Äì aktuell bitte Beschreibung verwenden.');return false;">Konfigurator-Hinweis</a>
      </div>
    </div>
  </section>

  <!-- WARENKORB / ANFRAGE / BESTELLUNG -->
  <aside id="cart" class="cart">
    <div class="row" style="justify-content:space-between">
      <h3 style="margin:0">Warenkorb</h3>
      <button class="ghost" id="closeCart">‚úñ</button>
    </div>

    <div id="cartItems" style="margin-top:6px"></div>

    <div class="row" style="justify-content:space-between;margin-top:8px">
      <span class="muted">Zwischensumme (Netto)</span><b id="subtotal">‚Ç¨0,00</b>
    </div>
    <label class="small" style="display:flex;gap:6px;align-items:center;margin-top:6px">
      <input type="checkbox" id="vatToggle" checked/> Preise inkl. 20 % USt.
    </label>
    <div class="row" style="justify-content:space-between;margin-top:4px">
      <span class="muted">Gesamt (Netto)</span><b id="totalNet">‚Ç¨0,00</b>
    </div>
    <div class="row" style="justify-content:space-between">
      <span class="muted">Gesamt (Brutto)</span><b id="totalGross">‚Ç¨0,00</b>
    </div>

    <div class="row" style="gap:8px;margin-top:8px">
      <button class="outline" id="clear">Leeren</button>
      <a id="download" class="outline" download="holzwurm-warenkorb.json"><button class="outline">JSON exportieren</button></a>
    </div>

    <!-- ANFRAGE -->
    <div class="card" style="margin-top:12px">
      <div class="pad">
        <h4 style="margin:4px 0 8px">Unverbindliche Angebotsanfrage</h4>

        <div class="row" style="gap:8px">
          <input id="c_company" placeholder="Firma (optional)" style="flex:1"/>
          <input id="c_name" placeholder="Ihr Name *" style="flex:1"/>
        </div>

        <input id="c_email" placeholder="E-Mail *" type="email" style="width:100%;margin-top:8px"/>
        <input id="c_phone" placeholder="Telefon (optional)" style="width:100%;margin-top:8px"/>
        <input id="c_addr" placeholder="Adresse (f√ºr Angebot/Lieferung)" style="width:100%;margin-top:8px"/>

        <div class="row" style="gap:8px;margin-top:8px">
          <select id="c_delivery" style="flex:1">
            <option value="Abholung">Abholung</option>
            <option value="Lieferung">Lieferung</option>
          </select>
          <input id="c_date" type="date" style="flex:1"/>
        </div>

        <textarea id="c_notes" placeholder="Hinweise (z. B. Zuschnittma√üe, Kante, Termin)" style="width:100%;margin-top:8px"></textarea>

        <input id="c_files" type="file" multiple accept=".dxf,.pdf,.jpg,.jpeg,.png"
               style="width:100%;margin-top:8px"/>
        <p class="small muted" style="margin:6px 0 0">In der Demo werden Dateinamen/Gr√∂√üen nur im JSON aufgef√ºhrt.</p>

        <label class="small" style="display:block;margin-top:6px">
          <input type="checkbox" id="c_gdpr"/>
          Ich bin mit der Verarbeitung meiner Daten zur Angebotserstellung einverstanden.
        </label>

        <button id="send" style="width:100%;margin-top:8px">‚úÖ Unverbindlich anfragen</button>
        <div id="hint" class="small muted" style="margin-top:6px;display:none">
          ‚úÖ Demo: Anfrage in der Browser-Konsole ausgegeben. F√ºr echten Versand bitte Mail-Integration aktivieren.
        </div>

        <details class="small" style="margin-top:6px;color:#374151">
          <summary>JSON ansehen (f√ºr API)</summary>
          <pre id="payload" style="max-height:220px;overflow:auto;background:#f3f4f6;padding:10px;border-radius:12px"></pre>
        </details>
      </div>
    </div>

    <!-- BESTELLUNG (nur bei rein bestellbaren Artikeln) -->
    <div id="orderCard" class="card" style="margin-top:12px;display:none">
      <div class="pad">
        <h4 style="margin:4px 0 8px">Jetzt bestellen</h4>
        <div class="row" style="gap:8px">
          <input id="o_name" placeholder="Ihr Name *" style="flex:1"/>
          <input id="o_email" placeholder="E-Mail *" type="email" style="flex:1"/>
        </div>
        <input id="o_addr" placeholder="Lieferadresse *" style="width:100%;margin-top:8px"/>
        <div class="row" style="gap:8px;margin-top:8px">
          <select id="o_shipping" style="flex:1">
            <option value="Abholung">Abholung</option>
            <option value="Lieferung">Lieferung</option>
          </select>
          <select id="o_payment" style="flex:1">
            <option value="Rechnung">Rechnung</option>
            <option value="Bar/EC bei Abholung">Bar/EC bei Abholung</option>
          </select>
        </div>
        <button id="orderNow" style="width:100%;margin-top:8px">üßæ Bestellung absenden</button>
        <div class="small muted" style="margin-top:6px">
          Hinweis: Demo-Checkout ‚Äì Bestellung wird als JSON in der Konsole ausgegeben.
        </div>
      </div>
    </div>
  </aside>

  <footer class="container">
    ¬© <span id="year"></span> Holzwurm GmbH ¬∑ Demoprojekt ohne Backend. Angebotsanfrage erzeugt JSON.
  </footer>
</main>

<script>
/* ===== Produktdaten (GJ 2022 Preise) + Fotos aus ./img/ ===== */
const PRODUCTS = [
  {
    id: "kom2",
    name: "Kommode 2-teilig",
    sku: "STD-K2",
    price: 181.00, unit: "Stk",
    orderable: true,
    images: [
      "img/Kommode 2 teillig ikea.avif"
    ],
    description: "Zweiteilige Standard-Kommode: Korpus Spanplatte, Fronten lackiert, Metallgriffe."
  },
  {
    id: "kom3",
    name: "Kommode 3-teilig",
    sku: "STD-K3",
    price: 242.00, unit: "Stk",
    orderable: true,
    images: [
      "img/Kommode 3 teillig ikea.avif"
    ],
    description: "Dreiteilige Kommode, push-to-open, h√∂henverstellbare F√º√üe, Kanten ABS 2 mm."
  },
  {
    id: "kom4",
    name: "Kommode 4-teilig",
    sku: "STD-K4",
    price: 303.00, unit: "Stk",
    orderable: true,
    images: [
      "img/Kommode 4 teillig ikea.avif",
      "img/Kommode 4 teilig wei√ü ikea 2.avif"
    ],
    description: "Vierteilige Kommode mit Vollausz√ºgen (30 kg), Oberfl√§che HPL robust."
  },
  {
    id: "cab-small",
    name: "Schrank klein",
    sku: "STD-CS",
    price: 405.00, unit: "Stk",
    orderable: true,
    images: [
      "img/schrank klein ikea.avif",
      "img/schrank klein ikea 2.avif"
    ],
    description: "Kleiderschrank 2-t√ºrig, Fachb√∂den verstellbar, Stange Alu, Softclose."
  },
  {
    id: "cab-big",
    name: "Schrank gro√ü",
    sku: "STD-CB",
    price: 458.00, unit: "Stk",
    orderable: true,
    images: [
      "img/Schrank gro√ü ikea 2.avif",
      "img/Schrank gro√ü ikea wei√ü.avif"
    ],
    description: "Gro√üer Schrank mit 3 Fachb√∂den und 2 Schubladen, Korpus Dekor Eiche."
  },
  {
    id: "custom-base",
    name: "Individualzuschnitte (Basis)",
    sku: "CUST-BASE",
    price: 1398.00, unit: "Auftrag",
    inquiryOnly: true,
    images: [
      "https://images.unsplash.com/photo-1555529771-35a38c3b32c9?q=80&w=1200&auto=format&fit=crop"
    ],
    description: "Basis f√ºr ma√ügefertigte M√∂bel-/Zuschnitte. Skizze/Details bitte beilegen."
  }
];

/* Globale Variantenvorgaben */
const COLORS = ["wei√ü","grau","braun","schwarz"];
const FINISHES = ["glatt","matt"];

const fmt = n=> new Intl.NumberFormat("de-AT",{style:"currency",currency:"EUR"}).format(n);
const state = { cart: [], query: "" };
const el = s => document.querySelector(s);
const uid = () => Math.random().toString(36).slice(2)+Date.now().toString(36);

/* Produkte rendern: inkl. Galerie + Variantenauswahl je Karte */
function renderProducts(){
  const q = state.query.toLowerCase();
  el("#products").innerHTML = PRODUCTS
    .filter(p => (p.name+p.sku+(p.tags||[]).join(" ")).toLowerCase().includes(q))
    .map(p => {
      const imgs = p.images && p.images.length ? p.images : ["https://picsum.photos/800/500"];
      const colorSel = `
        <label class="small muted" style="display:block;margin-top:6px">Korpusfarbe</label>
        <select id="opt-color-${p.id}" style="width:100%">
          ${COLORS.map(c=>`<option value="${c}">${c}</option>`).join("")}
        </select>`;
      const finishSel = `
        <label class="small muted" style="display:block;margin-top:6px">Oberfl√§che</label>
        <select id="opt-finish-${p.id}" style="width:100%">
          ${FINISHES.map(f=>`<option value="${f}">${f}</option>`).join("")}
        </select>`;
      return `
      <div class="card">
        <img class="main" src="${imgs[0]}" alt="${p.name}" data-main="${p.id}" />
        <div class="pad">
          <div class="row" style="justify-content:space-between;align-items:flex-start">
            <div><b>${p.name}</b></div>
            <div class="small muted" title="Artikelnummer">${p.sku}</div>
          </div>
          <p class="small muted" style="margin:6px 0 8px">${p.description || ""}</p>

          ${imgs.length>1 ? `
            <div class="row" style="gap:6px;margin-bottom:6px">
              ${imgs.map(u=>`<img class="thumb" src="${u}" alt="thumb" onclick="swapImage('${p.id}','${u}')">`).join("")}
            </div>` : ""}

          ${colorSel}${finishSel}

          <div class="row" style="justify-content:space-between;margin-top:8px">
            <div class="small"><span class="muted">Preis</span> <b>${fmt(p.price)}</b> / ${p.unit}</div>
            <button onclick="add('${p.id}')">üõí In den Warenkorb</button>
          </div>

          ${p.orderable ? `<div class="small muted" style="margin-top:6px">Direkt bestellbar</div>`
                        : `<div class="small muted" style="margin-top:6px">Nur Anfrage (Individual)</div>`}
        </div>
      </div>`;
    }).join("");
}
function swapImage(pid,url){
  const img = document.querySelector(`img[data-main="${pid}"]`); if(img) img.src = url;
}

/* Warenkorb-Operationen (mit Varianten-Zusammenfassung) */
function add(productId){
  const p = PRODUCTS.find(x=>x.id===productId);
  const color = el(`#opt-color-${productId}`)?.value || "wei√ü";
  const finish = el(`#opt-finish-${productId}`)?.value || "glatt";
  const mergeKey = `${productId}__${color}__${finish}__std`;

  const found = state.cart.find(i => i.mergeKey===mergeKey && !i.note);
  if(found){ found.qty += 1; }
  else{
    state.cart.push({
      cartId: uid(),
      mergeKey,
      id: productId,
      sku: p.sku,
      name: p.name,
      price: p.price,
      unit: p.unit,
      image: (p.images&&p.images[0])||"",
      qty: 1,
      color, finish,
      orderable: p.orderable,
      inquiryOnly: p.inquiryOnly
    });
  }
  renderCart();
}

function changeQty(cartId,qty){
  const it = state.cart.find(c=>c.cartId===cartId);
  if(it){ it.qty = Math.max(1, qty||1); renderCart(); }
}
function removeItem(cartId){ state.cart = state.cart.filter(c=>c.cartId!==cartId); renderCart(); }
function clearCart(){ state.cart = []; renderCart(); }

/* Individualzuschnitt hinzuf√ºgen (mit Lieferzeit-Preis) */
function addCustom(){
  const qty  = Math.max(1, parseInt(el("#custom_qty").value || "1", 10));
  const name = (el("#custom_title").value || "Individualzuschnitt").trim();
  const note = (el("#custom_note").value || "").trim();
  const base = PRODUCTS.find(p => p.id === "custom-base");
  if(!base){ alert("Basisartikel 'Individualzuschnitte' fehlt."); return; }

  const speed = (el("#custom_speed")?.value || "15");
  const priceMap = { "8": 1467.90, "15": 1425.96, "20": 1370.04 };
  const price = priceMap[speed] ?? base.price;

  state.cart.push({
    cartId: uid(),
    mergeKey: `custom__${speed}`, // keine Zusammenfassung ‚Äì individuelle Position
    id: "custom-base",
    sku: base.sku + `-${speed}d`,
    name: name || base.name,
    price,
    unit: base.unit,
    image: (base.images&&base.images[0]) || "",
    qty, note,
    inquiryOnly: true
  });

  el("#custom_title").value = ""; el("#custom_note").value  = ""; el("#custom_qty").value   = 1;
  if(el("#custom_speed")) el("#custom_speed").value = "15";

  renderCart();
}

/* Warenkorb rendern + Payload bauen */
function renderCart(){
  el("#cartCount").textContent = "(" + state.cart.length + ")";
  el("#cartItems").innerHTML = state.cart.map(it=>`
    <div class="row" style="gap:8px;margin:10px 0">
      <img src="${it.image||'https://picsum.photos/200/150'}" style="width:72px;height:56px;object-fit:cover;border-radius:10px">
      <div style="flex:1">
        <div><b>${it.name}</b></div>
        <div class="small muted">${it.sku||""}</div>
        ${it.color ? `<div class="small">Korpus: ${it.color}, Oberfl√§che: ${it.finish||"-"}</div>` : ""}
        ${it.note ? `<div class="small" style="margin-top:4px"><b>Notiz:</b> ${it.note}</div>` : ""}
        <div class="small">${fmt(it.price)} / ${it.unit}</div>
        <div class="row" style="gap:6px;margin-top:6px">
          <input type="number" min="1" value="${it.qty}" style="width:70px" onchange="changeQty('${it.cartId}', this.value)">
          <button class="ghost" onclick="removeItem('${it.cartId}')">üóëÔ∏è Entfernen</button>
        </div>
      </div>
    </div>`).join("") || '<div class="muted small" style="padding:8px 0">Noch keine Artikel.</div>';

  const VAT_RATE = 0.20;
  const sumNet = state.cart.reduce((a,it)=>a+it.qty*it.price,0);
  const vatOn = el("#vatToggle")?.checked ?? true;
  const sumGross = vatOn ? sumNet*(1+VAT_RATE) : sumNet;

  el("#subtotal").textContent   = fmt(sumNet);
  el("#totalNet").textContent   = fmt(sumNet);
  el("#totalGross").textContent = fmt(sumGross);

  el("#download").setAttribute("href","data:application/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(state.cart,null,2)));

  const files = Array.from((el("#c_files") && el("#c_files").files) ? el("#c_files").files : []);
  const fileMeta = files.map(f => ({ name: f.name, size: f.size, type: f.type }));

  const payload = {
    company: el("#c_company")?.value || "",
    contact: el("#c_name")?.value || "",
    email:   el("#c_email")?.value || "",
    phone:   el("#c_phone")?.value || "",
    address: el("#c_addr")?.value || "",
    delivery: el("#c_delivery")?.value || "Abholung",
    requestedDate: el("#c_date")?.value || "",
    notes:   el("#c_notes")?.value || "",
    items: state.cart.map(({id,sku,name,qty,price,unit,note,color,finish})=>({id,sku,name,qty,price,unit,note,color,finish})),
    totals: { net: sumNet, vatRate: VAT_RATE, gross: sumGross, vatIncluded: vatOn },
    files: fileMeta,
    createdAt: new Date().toISOString(),
    source: "holzwurm-dummy-shop-html"
  };
  el("#payload").textContent = JSON.stringify(payload,null,2);

  /* Bestellkarte nur zeigen, wenn alle Positionen bestellbar (keine inquiryOnly) */
  const hasItems = state.cart.length>0;
  const allOrderable = hasItems && state.cart.every(i => i.inquiryOnly ? false : (i.orderable ?? true));
  const orderCard = el("#orderCard");
  if(orderCard) orderCard.style.display = allOrderable ? "block" : "none";

  if(allOrderable){
    const orderPayload = {
      type: "order",
      customer: {
        name:  el("#o_name")?.value || "",
        email: el("#o_email")?.value || "",
        address: el("#o_addr")?.value || "",
        shipping: el("#o_shipping")?.value || "Abholung",
        payment: el("#o_payment")?.value || "Rechnung"
      },
      items: state.cart.map(({id,sku,name,qty,price,unit,color,finish})=>({id,sku,name,qty,price,unit,color,finish})),
      totals: { net: sumNet, vatRate: 0.20, gross: sumGross, vatIncluded: vatOn },
      createdAt: new Date().toISOString(),
      source: "holzwurm-dummy-shop-html"
    };
    const orderBtn = el("#orderNow");
    if(orderBtn){
      orderBtn.onclick = ()=>{
        if(!orderPayload.customer.name || !orderPayload.customer.email || !orderPayload.customer.address){
          alert("Bitte Name, E-Mail und Lieferadresse angeben."); return;
        }
        console.log("DEMO: Bestellung", orderPayload);
        alert("Danke! Bestellung (Demo) erzeugt. Siehe Konsole.");
      };
    }
  }
}

/* Init */
document.addEventListener("DOMContentLoaded",()=>{
  el("#year").textContent = new Date().getFullYear();
  el("#cartBtn").onclick = ()=> el("#cart").classList.add("open");
  el("#closeCart").onclick = ()=> el("#cart").classList.remove("open");
  el("#clear").onclick = clearCart;
  el("#search").oninput = (e)=>{ state.query = e.target.value; renderProducts(); };
  if(el("#vatToggle")) el("#vatToggle").onchange = renderCart;

  /* Anfrage absenden (Demo) */
  el("#send").onclick = async ()=>{
    const name = el("#c_name").value.trim(), email = el("#c_email").value.trim();
    if(!name || !email){ alert("Bitte Name und E-Mail angeben."); return; }
    if(!el("#c_gdpr").checked){ alert("Bitte Datenschutz-Einwilligung best√§tigen."); return; }
    try{
      const payload = JSON.parse(el("#payload").textContent);
      console.log("DEMO: Angebotsanfrage", payload);
      el("#hint").style.display = "block";
      alert("Danke! Ihre Anfrage wurde (in der Demo) erzeugt. Siehe Konsole/JSON.");
      // Echte Mail? Z. B. Formspree/EmailJS hier integrieren.
    }catch(e){ console.error(e); alert("Fehler beim Erzeugen der Anfrage."); }
  };

  renderProducts(); renderCart();
});
</script>
</body>
</html>
